#This file will need to use the DataManager,FlightSearch, FlightData, NotificationManager classes to achieve the program requirements.

from dotenv import load_dotenv
import os
from data_manager import DataManager
from flight_search import FlightSearch
from datetime import datetime,timedelta
from flight_data import FlightData

load_dotenv()
'''U should make main in such a way that i only puts the iatacodes once and thats it'''

# #sheety object for handling google sheet data
# sheety_data = DataManager(url=os.getenv("SH_URL"),auth=os.getenv("SH_AUTH"))

# #get the list of cities in the google sheet
# list = sheety_data.get_cities()

# #FlightSearch object for talking to the flight search api
# flights = FlightSearch(amad_api=os.getenv("AMAD_API"), amad_api_secret=os.getenv("AMAD_API_SECRET"))

# #get iatacodes for the cities in list using the FlightSearch object
# iatacodes = flights.get_iatas(list)

# #enter the iatacodes into the google sheets
# sheety_data.write_iata(iatacodes)

# flights = FlightSearch(amad_api=os.getenv("AMAD_API"), amad_api_secret=os.getenv("AMAD_API_SECRET"))
# flights.get_lower_prices(iata_code='ATL')


sheety_data = DataManager(url=os.getenv("SH_URL"),auth=os.getenv("SH_AUTH"))
citydata_dict = sheety_data.make_citydata_dict()

flight_data = FlightData(citydata_dict=citydata_dict)

data={'meta': {'count': 2}, 'data': [{'type': 'flight-offer', 'id': '1', 'source': 'GDS', 'instantTicketingRequired': False, 'nonHomogeneous': False, 'oneWay': False, 'isUpsellOffer': False, 'lastTicketingDate': '2025-10-04', 'lastTicketingDateTime': '2025-10-04', 'numberOfBookableSeats': 5, 'itineraries': [{'duration': 'PT12H21M', 'segments': [{'departure': {'iataCode': 'LHR', 'terminal': '2', 'at': '2025-10-05T08:15:00'}, 'arrival': {'iataCode': 'JFK', 'terminal': '5', 'at': '2025-10-05T11:18:00'}, 'carrierCode': 'B6', 'number': '2220', 'aircraft': {'code': '32Q'}, 'operating': {'carrierCode': 'B6'}, 'duration': 'PT8H3M', 'id': '1', 'numberOfStops': 0, 'blacklistedInEU': False}, {'departure': {'iataCode': 'JFK', 'terminal': '5', 'at': '2025-10-05T12:55:00'}, 'arrival': {'iataCode': 'ATL', 'terminal': 'N', 'at': '2025-10-05T15:36:00'}, 'carrierCode': 'B6', 'number': '419', 'aircraft': {'code': '223'}, 'operating': {'carrierCode': 'B6'}, 'duration': 'PT2H41M', 'id': '2', 'numberOfStops': 0, 'blacklistedInEU': False}]}], 'price': {'currency': 'USD', 'total': '2831.03', 'base': '1818.00', 'fees': [{'amount': '0.00', 'type': 'SUPPLIER'}, {'amount': '0.00', 'type': 'TICKETING'}], 'grandTotal': '2831.03'}, 'pricingOptions': {'fareType': ['PUBLISHED'], 'includedCheckedBagsOnly': True}, 'validatingAirlineCodes': ['B6'], 'travelerPricings': [{'travelerId': '1', 'fareOption': 'STANDARD', 'travelerType': 'ADULT', 'price': {'currency': 'USD', 'total': '2831.03', 'base': '1818.00'}, 'fareDetailsBySegment': [{'segmentId': '1', 'cabin': 'BUSINESS', 'fareBasis': 'IC0LEW', 'brandedFare': 'MN', 'brandedFareLabel': 'MINT', 'class': 'I', 'includedCheckedBags': {'quantity': 2}, 'includedCabinBags': {'quantity': 2}, 'amenities': [{'description': 'LIE FLAT BED', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'EXTRA LEGROOM', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'ADVANCE SEAT SELECTION', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'SNACK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'ALCOHOLIC DRINK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'NON ALCOHOLIC DRINK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'MEAL', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}]}, {'segmentId': '2', 'cabin': 'ECONOMY', 'fareBasis': 'IC0LEW', 'brandedFare': 'MN', 'brandedFareLabel': 'MINT', 'class': 'B', 'includedCheckedBags': {'quantity': 2}, 'includedCabinBags': {'quantity': 2}, 'amenities': [{'description': 'LIE FLAT BED', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'EXTRA LEGROOM', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'ADVANCE SEAT SELECTION', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'SNACK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'ALCOHOLIC DRINK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'NON ALCOHOLIC DRINK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'MEAL', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}]}]}]}, {'type': 'flight-offer', 'id': '2', 'source': 'GDS', 'instantTicketingRequired': False, 'nonHomogeneous': False, 'oneWay': False, 'isUpsellOffer': False, 'lastTicketingDate': '2025-10-04', 'lastTicketingDateTime': '2025-10-04', 'numberOfBookableSeats': 5, 'itineraries': [{'duration': 'PT20H55M', 'segments': [{'departure': {'iataCode': 'LHR', 'terminal': '2', 'at': '2025-10-05T08:15:00'}, 'arrival': {'iataCode': 'JFK', 'terminal': '5', 'at': '2025-10-05T11:18:00'}, 'carrierCode': 'B6', 'number': '2220', 'aircraft': {'code': '32Q'}, 'operating': {'carrierCode': 'B6'}, 'duration': 'PT8H3M', 'id': '3', 'numberOfStops': 0, 'blacklistedInEU': False}, {'departure': {'iataCode': 'JFK', 'terminal': '5', 'at': '2025-10-05T21:40:00'}, 'arrival': {'iataCode': 'ATL', 'terminal': 'N', 'at': '2025-10-06T00:10:00'}, 'carrierCode': 'B6', 'number': '719', 'aircraft': {'code': '223'}, 'operating': {'carrierCode': 'B6'}, 'duration': 'PT2H30M', 'id': '4', 'numberOfStops': 0, 'blacklistedInEU': False}]}], 'price': {'currency': 'USD', 'total': '2831.03', 'base': '1818.00', 'fees': [{'amount': '0.00', 'type': 'SUPPLIER'}, {'amount': '0.00', 'type': 'TICKETING'}], 'grandTotal': '2831.03'}, 'pricingOptions': {'fareType': ['PUBLISHED'], 'includedCheckedBagsOnly': True}, 'validatingAirlineCodes': ['B6'], 'travelerPricings': [{'travelerId': '1', 'fareOption': 'STANDARD', 'travelerType': 'ADULT', 'price': {'currency': 'USD', 'total': '2831.03', 'base': '1818.00'}, 'fareDetailsBySegment': [{'segmentId': '3', 'cabin': 'BUSINESS', 'fareBasis': 'IC0LEW', 'brandedFare': 'MN', 'brandedFareLabel': 'MINT', 'class': 'I', 'includedCheckedBags': {'quantity': 2}, 'includedCabinBags': {'quantity': 2}, 'amenities': [{'description': 'LIE FLAT BED', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'EXTRA LEGROOM', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'ADVANCE SEAT SELECTION', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'SNACK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'ALCOHOLIC DRINK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'NON ALCOHOLIC DRINK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'MEAL', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}]}, {'segmentId': '4', 'cabin': 'ECONOMY', 'fareBasis': 'IC0LEW', 'brandedFare': 'MN', 'brandedFareLabel': 'MINT', 'class': 'B', 'includedCheckedBags': {'quantity': 2}, 'includedCabinBags': {'quantity': 2}, 'amenities': [{'description': 'LIE FLAT BED', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'EXTRA LEGROOM', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'ADVANCE SEAT SELECTION', 'isChargeable': False, 'amenityType': 'PRE_RESERVED_SEAT', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'SNACK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'ALCOHOLIC DRINK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'NON ALCOHOLIC DRINK', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}, {'description': 'MEAL', 'isChargeable': False, 'amenityType': 'MEAL', 'amenityProvider': {'name': 'BrandedFare'}}]}]}]}], 'dictionaries': {'locations': {'LHR': {'cityCode': 'LON', 'countryCode': 'GB'}, 'ATL': {'cityCode': 'ATL', 'countryCode': 'US'}, 'JFK': {'cityCode': 'NYC', 'countryCode': 'US'}}, 'aircraft': {'32Q': 'AIRBUS A321NEO', '223': 'AIRBUS  A220-300'}, 'currencies': {'USD': 'US DOLLAR'}, 'carriers': {'B6': 'JETBLUE AIRWAYS'}}}

data = flight_data.filter_by_price(iataCode_flights=data)

print(data)
